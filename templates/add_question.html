<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Questions - {{ quiz.title }} - Quizera</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <a href="{{ url_for('home') }}" class="text-2xl font-bold">Quizera</a>
                    <span class="text-blue-200">Add Questions</span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <a href="{{ url_for('dashboard') }}" class="hover:text-blue-200 transition-colors">
                        <i class="fas fa-tachometer-alt mr-1"></i>Dashboard
                    </a>
                    <a href="{{ url_for('logout') }}" class="hover:text-blue-200 transition-colors">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    <div class="container mx-auto px-4 pt-4">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="flash-message bg-blue-50 border border-blue-200 text-blue-800 p-3 mb-4 rounded-lg">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <div class="container mx-auto px-4 py-6">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="mb-6">
                <div class="flex items-center space-x-2 text-sm text-gray-600 mb-4">
                    <a href="{{ url_for('dashboard') }}" class="hover:text-blue-600">Dashboard</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="{{ url_for('manage_quiz', quiz_id=quiz_id) }}" class="hover:text-blue-600">{{ quiz.title }}</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-gray-800">Add Questions</span>
                </div>
                <h1 class="text-2xl font-medium text-gray-900 mb-2">Add questions to quiz</h1>
                <p class="text-gray-600 text-sm">Quiz: {{ quiz.title }}</p>
            </div>

            <!-- Method Selection -->
            <div class="bg-white rounded-lg border border-gray-200 mb-6">
                <div class="p-4 border-b border-gray-200">
                    <div class="flex space-x-4">
                        <button id="singleMethodBtn" class="method-btn active px-4 py-2 text-sm font-medium rounded-md bg-purple-100 text-purple-700 border border-purple-200">
                            <i class="fas fa-plus mr-2"></i>Single Question
                        </button>
                        <button id="bulkMethodBtn" class="method-btn px-4 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-100 border border-gray-200">
                            <i class="fas fa-list mr-2"></i>Multiple Questions
                        </button>
                        <button id="csvMethodBtn" class="method-btn px-4 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-100 border border-gray-200">
                            <i class="fas fa-upload mr-2"></i>CSV Upload
                        </button>
                    </div>
                </div>

                <!-- Single Question Method -->
                <div id="singleMethod" class="method-content">
                    <form method="POST" id="singleQuestionForm">
                        <!-- Question Text Section -->
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-start space-x-4">
                                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0 mt-2">
                                    <i class="fas fa-question text-purple-600 text-lg"></i>
                                </div>
                                <div class="flex-1">
                                    <textarea name="question_text" 
                                             placeholder="Question" 
                                             class="w-full text-lg border-0 border-b-2 border-gray-200 focus:border-purple-500 focus:ring-0 resize-none outline-none p-2 bg-transparent placeholder-gray-400" 
                                             rows="2" 
                                             required></textarea>
                                    <div class="mt-4">
                                        <select name="question_type" id="questionType" class="bg-gray-50 border border-gray-200 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
                                            <option value="">Question Type</option>
                                            <option value="multiple_choice">Multiple choice</option>
                                            <option value="true_false">True/False</option>
                                            <option value="identification">Short answer</option>
                                            <option value="enumeration">Paragraph</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Answer Options Section -->
                        <div class="p-6">
                            <!-- Multiple Choice Options -->
                            <div id="multipleChoiceOptions" class="hidden">
                                <div class="space-y-4">
                                    <div class="flex items-center space-x-3">
                                        <input type="radio" name="correct_answer" value="A" id="correctA" class="w-4 h-4 text-purple-600 border-gray-300">
                                        <div class="flex items-center space-x-3 flex-1">
                                            <span class="w-6 h-6 bg-gray-100 rounded-full flex items-center justify-center text-sm font-medium">A</span>
                                            <input type="text" name="option_a" placeholder="Option 1" class="flex-1 border-0 border-b border-gray-200 focus:border-purple-500 focus:ring-0 outline-none py-2 bg-transparent">
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <input type="radio" name="correct_answer" value="B" id="correctB" class="w-4 h-4 text-purple-600 border-gray-300">
                                        <div class="flex items-center space-x-3 flex-1">
                                            <span class="w-6 h-6 bg-gray-100 rounded-full flex items-center justify-center text-sm font-medium">B</span>
                                            <input type="text" name="option_b" placeholder="Option 2" class="flex-1 border-0 border-b border-gray-200 focus:border-purple-500 focus:ring-0 outline-none py-2 bg-transparent">
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <input type="radio" name="correct_answer" value="C" id="correctC" class="w-4 h-4 text-purple-600 border-gray-300">
                                        <div class="flex items-center space-x-3 flex-1">
                                            <span class="w-6 h-6 bg-gray-100 rounded-full flex items-center justify-center text-sm font-medium">C</span>
                                            <input type="text" name="option_c" placeholder="Option 3" class="flex-1 border-0 border-b border-gray-200 focus:border-purple-500 focus:ring-0 outline-none py-2 bg-transparent">
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <input type="radio" name="correct_answer" value="D" id="correctD" class="w-4 h-4 text-purple-600 border-gray-300">
                                        <div class="flex items-center space-x-3 flex-1">
                                            <span class="w-6 h-6 bg-gray-100 rounded-full flex items-center justify-center text-sm font-medium">D</span>
                                            <input type="text" name="option_d" placeholder="Option 4" class="flex-1 border-0 border-b border-gray-200 focus:border-purple-500 focus:ring-0 outline-none py-2 bg-transparent">
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-4 p-3 bg-blue-50 rounded-md">
                                    <p class="text-sm text-blue-800">
                                        <i class="fas fa-info-circle mr-2"></i>
                                        Select the radio button next to the correct answer
                                    </p>
                                </div>
                            </div>

                            <!-- True/False Options -->
                            <div id="trueFalseOptions" class="hidden">
                                <div class="space-y-3">
                                    <div class="flex items-center space-x-3">
                                        <input type="radio" name="tf_answer" value="true" id="tfTrue" class="w-4 h-4 text-purple-600 border-gray-300">
                                        <label for="tfTrue" class="text-gray-700">True</label>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <input type="radio" name="tf_answer" value="false" id="tfFalse" class="w-4 h-4 text-purple-600 border-gray-300">
                                        <label for="tfFalse" class="text-gray-700">False</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Short Answer/Paragraph Options -->
                            <div id="openEndedOptions" class="hidden">
                                <div class="space-y-4">
                                    <div class="border border-gray-200 rounded-md p-4 bg-gray-50">
                                        <p class="text-sm text-gray-600 mb-3">Correct answer(s)</p>
                                        <textarea name="correct_answers" 
                                                 rows="3" 
                                                 class="w-full border-0 bg-transparent resize-none outline-none text-gray-700 placeholder-gray-400" 
                                                 placeholder="Enter acceptable answers separated by commas"></textarea>
                                    </div>
                                    <p class="text-xs text-gray-500">
                                        For multiple acceptable answers, separate them with commas (e.g., JavaScript, JS, javascript)
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Footer Section -->
                        <div class="p-6 bg-gray-50 border-t border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <label class="text-sm text-gray-600">Points:</label>
                                    <input type="number" name="points" value="1" min="1" max="10" class="w-16 px-2 py-1 border border-gray-200 rounded text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                </div>
                                
                                <div class="flex items-center space-x-3">
                                    <a href="{{ url_for('manage_quiz', quiz_id=quiz_id) }}" class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors">
                                        Cancel
                                    </a>
                                    <button type="submit" class="bg-purple-600 text-white px-6 py-2 text-sm rounded-md hover:bg-purple-700 transition-colors shadow-sm">
                                        Add Question
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Bulk Questions Method -->
                <div id="bulkMethod" class="method-content hidden">
                    <div class="p-6">
                        <div class="mb-4">
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Add Multiple Questions</h3>
                            <p class="text-sm text-gray-600 mb-4">Add multiple questions at once. You can manually set answers after adding.</p>
                        </div>
                        
                        <div id="bulkQuestions">
                            <div class="bulk-question mb-6 p-4 border border-gray-200 rounded-lg">
                                <div class="flex items-start space-x-4 mb-4">
                                    <span class="question-number bg-purple-100 text-purple-700 w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium">1</span>
                                    <div class="flex-1">
                                        <select name="bulk_question_type[]" class="bulk-type-select bg-gray-50 border border-gray-200 rounded-md px-3 py-2 text-sm mb-3" required>
                                            <option value="">Question Type</option>
                                            <option value="multiple_choice">Multiple choice</option>
                                            <option value="true_false">True/False</option>
                                            <option value="identification">Short answer</option>
                                            <option value="enumeration">Paragraph</option>
                                        </select>
                                        <textarea name="bulk_question_text[]" placeholder="Question text" class="w-full border border-gray-200 rounded-md p-3 text-sm" rows="2" required></textarea>
                                        
                                        <!-- Multiple Choice Options -->
                                        <div class="bulk-mc-options hidden mt-3">
                                            <label class="text-sm text-gray-600 mb-2 block">Multiple Choice Options:</label>
                                            <div class="space-y-2 mb-3">
                                                <input type="text" name="bulk_option_a[]" placeholder="Option A" class="w-full border border-gray-200 rounded px-3 py-2 text-sm">
                                                <input type="text" name="bulk_option_b[]" placeholder="Option B" class="w-full border border-gray-200 rounded px-3 py-2 text-sm">
                                                <input type="text" name="bulk_option_c[]" placeholder="Option C" class="w-full border border-gray-200 rounded px-3 py-2 text-sm">
                                                <input type="text" name="bulk_option_d[]" placeholder="Option D" class="w-full border border-gray-200 rounded px-3 py-2 text-sm">
                                            </div>
                                            <select name="bulk_correct_answer[]" class="border border-gray-200 rounded px-3 py-2 text-sm">
                                                <option value="A">Correct Answer: A</option>
                                                <option value="B">Correct Answer: B</option>
                                                <option value="C">Correct Answer: C</option>
                                                <option value="D">Correct Answer: D</option>
                                            </select>
                                        </div>

                                        <!-- True/False Options -->
                                        <div class="bulk-tf-options hidden mt-3">
                                            <label class="text-sm text-gray-600 mb-2 block">Correct Answer:</label>
                                            <select name="bulk_tf_answer[]" class="border border-gray-200 rounded px-3 py-2 text-sm">
                                                <option value="true">True</option>
                                                <option value="false">False</option>
                                            </select>
                                        </div>

                                        <!-- Open Ended Options -->
                                        <div class="bulk-open-options hidden mt-3">
                                            <label class="text-sm text-gray-600 mb-2 block">Correct Answers (separated by commas):</label>
                                            <textarea name="bulk_answers[]" placeholder="Enter acceptable answers separated by commas" class="w-full border border-gray-200 rounded-md p-3 text-sm bg-gray-50" rows="2"></textarea>
                                        </div>
                                        
                                        <div class="mt-3 flex items-center space-x-4">
                                            <div class="flex items-center space-x-2">
                                                <label class="text-sm text-gray-600">Points:</label>
                                                <input type="number" name="bulk_points[]" value="1" min="1" max="10" class="w-16 px-2 py-1 border border-gray-200 rounded text-sm">
                                            </div>
                                            <button type="button" class="remove-question text-red-600 hover:text-red-800 text-sm" style="display: none;">
                                                <i class="fas fa-trash mr-1"></i>Remove
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50">
                            <button type="button" id="addBulkQuestion" class="text-purple-600 hover:text-purple-700 text-sm font-medium">
                                <i class="fas fa-plus mr-2"></i>Add Another Question
                            </button>
                            <div class="flex items-center space-x-3">
                                <a href="{{ url_for('manage_quiz', quiz_id=quiz_id) }}" class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors">
                                    Cancel
                                </a>
                                <button type="button" id="saveBulkQuestions" class="bg-purple-600 text-white px-6 py-2 text-sm rounded-md hover:bg-purple-700 transition-colors shadow-sm">
                                    Add All Questions
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CSV Upload Method -->
                <div id="csvMethod" class="method-content hidden">
                    <div class="p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Upload Questions from CSV</h3>
                        <p class="text-sm text-gray-600 mb-4">Upload a CSV file with your questions. The system will validate and parse them automatically.</p>

                        <!-- File Upload Area -->
                        <div class="mb-6">
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-400 transition-colors cursor-pointer" id="csvDropZone">
                                <input type="file" id="csvFile" accept=".csv" class="hidden">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                                <p class="text-lg font-medium text-gray-700 mb-2">Drop your CSV file here</p>
                                <p class="text-sm text-gray-500 mb-4">or <span class="text-purple-600 hover:text-purple-700 font-medium cursor-pointer" id="browseBtn">click to browse</span></p>
                                <p class="text-xs text-gray-400">Supported format: .csv files only (max 10MB)</p>
                            </div>
                            
                            <!-- Upload Progress -->
                            <div id="uploadProgress" class="hidden mt-4">
                                <div class="bg-gray-200 rounded-full h-2">
                                    <div id="progressBar" class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                                <p id="progressText" class="text-sm text-gray-600 mt-2">Uploading...</p>
                            </div>
                        </div>

                        <!-- Error Messages -->
                        <div id="errorMessages" class="hidden mb-6">
                            <div class="bg-red-50 border border-red-200 rounded-md p-4">
                                <div class="flex items-start">
                                    <i class="fas fa-exclamation-triangle text-red-500 mt-1 mr-3"></i>
                                    <div>
                                        <h4 class="text-red-800 font-medium mb-2">Upload Errors</h4>
                                        <ul id="errorList" class="text-sm text-red-700 list-disc list-inside space-y-1"></ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CSV Format Guide -->
                        <div class="mb-6">
                            <h4 class="font-medium text-gray-900 mb-3">Required CSV Format:</h4>
                            <div class="bg-gray-50 border border-gray-200 rounded-md p-4">
                                <div class="mb-4">
                                    <h5 class="text-sm font-medium text-gray-700 mb-2">Column Headers (Required):</h5>
                                    <code class="text-sm bg-white px-2 py-1 rounded border">question_type,question_text,choices,answers,points</code>
                                </div>
                                
                                <table class="w-full text-left text-sm">
                                    <thead>
                                        <tr class="border-b border-gray-300">
                                            <th class="py-2 px-3 font-medium text-gray-700">Question Type</th>
                                            <th class="py-2 px-3 font-medium text-gray-700">Question Text</th>
                                            <th class="py-2 px-3 font-medium text-gray-700">Choices</th>
                                            <th class="py-2 px-3 font-medium text-gray-700">Answers</th>
                                            <th class="py-2 px-3 font-medium text-gray-700">Points</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-gray-600">
                                        <tr class="border-b border-gray-200">
                                            <td class="py-2 px-3">multiple_choice</td>
                                            <td class="py-2 px-3">"What is 2+2?"</td>
                                            <td class="py-2 px-3">"2|3|4|5"</td>
                                            <td class="py-2 px-3">"C"</td>
                                            <td class="py-2 px-3">1</td>
                                        </tr>
                                        <tr class="border-b border-gray-200">
                                            <td class="py-2 px-3">true_false</td>
                                            <td class="py-2 px-3">"The sky is blue"</td>
                                            <td class="py-2 px-3">""</td>
                                            <td class="py-2 px-3">"true"</td>
                                            <td class="py-2 px-3">1</td>
                                        </tr>
                                        <tr class="border-b border-gray-200">
                                            <td class="py-2 px-3">identification</td>
                                            <td class="py-2 px-3">"Capital of France?"</td>
                                            <td class="py-2 px-3">""</td>
                                            <td class="py-2 px-3">"Paris|paris"</td>
                                            <td class="py-2 px-3">2</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2 px-3">enumeration</td>
                                            <td class="py-2 px-3">"Explain photosynthesis"</td>
                                            <td class="py-2 px-3">""</td>
                                            <td class="py-2 px-3">"Process by which plants convert light energy"</td>
                                            <td class="py-2 px-3">3</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <div class="mt-4 p-3 bg-blue-50 rounded-md">
                                    <h5 class="text-sm font-medium text-blue-800 mb-2">Important Notes:</h5>
                                    <ul class="text-xs text-blue-700 space-y-1">
                                        <li>• Use quotes around text containing commas</li>
                                        <li>• For multiple choice: separate choices with | (pipe), answer should be A, B, C, or D</li>
                                        <li>• For true/false: leave choices empty, answer should be "true" or "false"</li>
                                        <li>• For identification/enumeration: leave choices empty, separate multiple answers with |</li>
                                        <li>• Valid question types: multiple_choice, true_false, identification, enumeration</li>
                                        <li>• Points must be a number between 1-10</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Sample CSV Download -->
                        <div class="mb-6">
                            <button id="downloadSample" class="text-purple-600 hover:text-purple-700 text-sm font-medium">
                                <i class="fas fa-download mr-2"></i>Download Sample CSV Template
                            </button>
                        </div>

                        <!-- Preview Section -->
                        <div id="csvPreview" class="hidden mb-6">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-medium text-gray-900">Preview Questions</h4>
                                <span id="validQuestionCount" class="text-sm text-green-600 font-medium"></span>
                            </div>
                            <div id="csvPreviewContent" class="bg-white border border-gray-200 rounded-md max-h-96 overflow-y-auto">
                                <!-- Preview content will be inserted here -->
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50">
                            <div class="text-sm text-gray-600">
                                <span id="csvQuestionCount">0</span> questions ready to import
                            </div>
                            <div class="flex items-center space-x-3">
                                <button type="button" id="clearCsv" class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors" disabled>
                                    Clear
                                </button>
                                <button type="button" id="importCsvQuestions" class="bg-purple-600 text-white px-6 py-2 text-sm rounded-md hover:bg-purple-700 transition-colors shadow-sm disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                                    Import Questions
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/addquestion.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>